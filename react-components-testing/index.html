<!DOCTYPE html>
<html lang="en">
<head>
	<title>React Components Testing with Jest & Enzyme</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="shower/themes/ribbon/styles/screen-16x10.css">
</head>
<body class="shower list">
	<header class="caption">
		<h1>React Components Testing with Jest & Enzyme</h1>
		<p>by Alyona Pysarenko</p>
	</header>

	<section class="slide" id="cover">
		<figure>
			<img class="cover" src="pictures/cover.png" alt="Jest and Enzyme">
		</figure>
		<h2>React Components Testing with Jest & Enzyme</h2>
		<p>by Alyona Pysarenko</p>
	</section>

	<section class="slide">
		<h2>Agenda</h2>
		<ol>
			<li>Introduction to Jest and Enzyme</li>
			<li>Define the correct order of components’ testing based on project structure</li>
			<li>Find what to omit in test coverage</li>
			<li>Identify the necessity of Snapshot Testing</li>
			<li>Define what to test in the component and in which order</li>
			<li>Provide detailed code examples</li>
		</ol>
	</section>

	<section class="slide slide-content-right jest-config">
		<figure class="pull-left">
			<img src="pictures/slide3.png" alt="Jest config">
		</figure>
		<div class="pull-right">
			<h2>Introduction<br> to Jest</h2>
			<p>Jest is used by Facebook to test all JavaScript code including React applications.</p>
			<p>Why Jest:</p>
			<ol>
				<li>Fast and sandboxed</li>
				<li>Built-in code coverage reports</li>
				<li>Zero configuration</li>
				<li>Powerful mocking library</li>
				<li>Snapshot Testing</li>
				<li>Works with TypeScript</li>
			</ol>
		</div>
	</section>

	<section class="slide jest-results">
		<div class="pull-left slide-content-left">
			<h2>How to run tests</h2>
			<p>yarn test</p>
		</div>
		<figure class="pull-right slide-content-right">
			<img src="pictures/slide6_1.png" alt="Jest start">
		</figure>
	</section>

	<section class="slide jest-run">
		<h2>How to verify results</h2>
		<p class="condensed-font">yarn test mmp/static/js/react/shared/forms/inputs/__tests__/RadiosInput.test.js</p>
		<div class="success">
			<p>Success</p>
			<figure class="jest-run-success">
				<img src="pictures/slide6_2.png" alt="Jest start success">
			</figure>
		</div>
	</section>

	<section class="slide jest-run">
		<div class="failed">
			<p>Failed</p>
			<figure class="jest-run-fail">
				<img src="pictures/slide6_3.png" alt="Jest start failed">
			</figure>
		</div>
	</section>

	<section class="slide slide-content-right enzyme-spec">
		<figure class="pull-left">
			<img src="pictures/slide7.png" alt="Enzyme">
		</figure>
		<div class="pull-right">
			<h2>Enzyme</h2>
			<p>Enzyme is JavaScript Testing utilities for React</p>
			<h3>Basic Usage</h3>
			<ol>
				<li>Shallow Rendering</li>
				<li>Full DOM Rendering</li>
				<li>Static Rendered Markup</li>
			</ol>
		</div>
	</section>

	<section class="slide components-testing-order">
		<h2>Define the correct order of components’ testing based on project structure</h2>
		<p><img src="pictures/slide8.png" alt="Project structure"></p>
	</section>

	<section class="slide test-coverage-queue">
		<img src="pictures/slide9.png" alt="Queue for Test Coverage">
	</section>

	<section class="slide final-components-order">
		<h2>The final components order</h2>
		<figure>
			<img src="pictures/slide10.png" alt="final components order">
		</figure>
	</section>

	<section class="slide">
		<h2>What should be omitted in test <br>coverage:</h2>
		<ol>
			<li>third-party libraries</li>
			<li>constants</li>
			<li>inline styles</li>
			<li>things not related to the tested component</li>
		</ol>
	</section>

	<section class="slide">
		<h2>Combine two testing approaches:</h2>
		<ol>
			<li><b><i>Snapshot Testing</i></b> <p>Capture snapshots of React trees to simplify testing and to analyze how state changes over time.</p></li>
			<li><b><i>Component logic testing</i></b></li>
		</ol>
	</section>

	<section class="slide step-one">
		<h2>How to test with snapshots</h2>
		<p><b>Step 1.</b> Use the <code>.toMatchSnapshot()</code> method in <code>expect</code> block to create the Snapshot itself:</p>
		<img src="pictures/TextInput.jpg" alt="text input testing">
	</section>

	<section class="slide step-two">
		<p><b>Step 2.</b> Create directory <code>__snapshots__</code> after first run containing autogenerated file with the extension <code>.snap</code>.</p>
		<p>Snapshot view:</p>
		<img src="pictures/TextInputSnap.png" alt="text input testing">

	</section>

	<section class="slide">
		<p><b>Step 3.</b> Push the snapshot into the repository and store it along<br> with the test.</p>
		<p>If the component has been changed, you just need to update the snapshot with <code>—updateSnapshot</code> flag or use the short form <code>u</code> flag.</p>
	</section>

	<section class="slide snapshot-work">
		<div class="double">
			<div>
				<h2>How snapshot works</h2>
				<p><b>1. The component has changed</b></p>
				<ol>
					<li>Run tests</li>
					<li>New snapshot is created, it compares with the stored snapshot</li>
					<li>Tests failed because snapshot is different</li>
				</ol>
			</div>
			<div>
				<img src="pictures/slide16.gif" alt="snapshot failed">
			</div>
		</div>
	</section>

	<section class="slide snapshot-work">
		<div class="double">
			<div>
				<h2>How snapshot works</h2>
				<p><b>2. The component has not changed</b></p>
				<ol>
					<li>Run tests</li>
					<li>New snapshot is created, it compares with the stored snapshot</li>
					<li>Tests passed because snapshot is identical</li>
				</ol>
			</div>
			<div>
				<img src="pictures/slide17.gif" alt="snapshot success">
			</div>
		</div>
	</section>

	<section class="slide issues">
		<h2>Main instructions for component <br>testing:</h2>
		<ol>
			<li>One snapshot per component</li>
			<li>Testing props</li>
			<li>Testing data types</li>
			<li>Events testing</li>
			<li>Testing conditions</li>
			<li>Testing state</li>
		</ol>
	</section>

	<section class="slide issues">
		<h2>Examples of Testing</h2>
		<p><b>1. Testing DateInput component</b></p>
		<p>Code listing on github: <a href="https://github.com/ned-alyona/testing-jest-enzyme/blob/master/shared/forms/inputs/DateInput.js">DateInput.js</a></p>
		<figure>
			<img src="pictures/dateInput.gif" alt="DateInput component">
		</figure>
	</section>

	<section class="slide default">
		<p>The DateInput component uses the library react-datepicker, with two utilities:</p>
		<ol>
			<li>valueToDate (converts value to date)</li>
			<li>dateToValue (converts date to value)</li>
		</ol>
		<p>List of default props for component rendering:</p>
		<img src="pictures/defaultProps.png" alt="default props">
	</section>

	<section class="slide default">
		<p>Mock date value:</p>
		<img src="pictures/mockDate.png" alt="mock date">
		<p>Create HOC to pass defaultProps</p>
		<img src="pictures/createHOC.png" alt="create HOC">
	</section>

	<section class="slide default">
		<p>Remember about <code>moment-timezone</code></p>
		<img src="pictures/momentTimezone.png" alt="moment-timezone">
		<p>Make component wrapper before each test</p>
		<img src="pictures/mount.png" alt="mount">
	</section>

	<section class="slide default">
		<p>Now the date input component is ready for testing:</p>
		<p><b>1. Create snapshot first:</b></p>
		<img src="pictures/snapshot.png" alt="snapshot">
	</section>

	<section class="slide default">
		<p><b>2. Testing props:</b></p>
		<img src="pictures/showMonthYearsDropdowns.png" alt="showMonthYearsDropdowns prop">
		<img src="pictures/nullValue.png" alt="null value prop">
	</section>

	<section class="slide default">
		<p><b>3. Test proptypes for value, date expected to be string:</b></p>
		<img src="pictures/valueType.png" alt="check the type of value">
	</section>

	<section class="slide default">
		<p><b>4. Test events:</b></p>
		<p>First, check the onChange event.</p>
		<ol>
			<li>mock onChange callback and setProps</li>
			<li>simulate change event with new target value</li>
			<li>check that onChange event has been called with new value</li>
		</ol>
		<img src="pictures/onChangeEvent.png" alt="onChange event">
	</section>

	<section class="slide default">
		<p>Ensure that the datepicker popup opens after a click on the date input</p>
		<img src="pictures/popupOpen.png" alt="popup open event">
		<p>Full tests listing: <a href="https://github.com/ned-alyona/testing-jest-enzyme/blob/master/shared/forms/inputs/__tests__/DateInput.test.js">DateInput.test.js</a></p>
	</section>

	<section class="slide">
		<p><b>2. HOC testing (Higher-Order Component)</b></p>
		<p><i>BaseFieldLayout:</i></p>
		<ol>
			<li>is wrapper for the form components like TextInput, CheckboxInput, etc.</li>
			<li>creates component layout (rendering labels, tooltips, icons, errors, ...)</li>
			<li>is used in BaseFieldHOC for wrapping the inputComponent and redux-form `Field` component</li>
		</ol>
		<p>Code listing for tested component: <a href="https://github.com/ned-alyona/testing-jest-enzyme/blob/master/shared/hoc/BaseFieldHOC.js">BaseFieldHOC.js</a></p>
	</section>

	<section class="slide default base-field-hoc">
		<p><i>Analyzing the HOC:</i></p>
		<ol>
			<li>receives only one prop <code>component</code>:
				<ol>
					<li>need to create this component</li>
					<li>wrap it in the BaseFieldHOC</li>
				</ol>
			</li>
			<li>decorate the wrapped HOC with redux-form</li>
			<li>render field inside redux `Provider` component to make the store available</li>
		</ol>
		<p>To mock the store, just do: <code>const store = createStore(() => ({}));</code><br>
		Before each test do:</p>
		<img src="pictures/BaseFieldHOC.png" alt="BaseFieldHOC">
	</section>

	<section class="slide default">
		<p>1. Create snapshot:</p>
		<img src="pictures/BaseFieldHOCsnapshot.png" alt="BaseFieldHOC snapshot">
		<p>2. Ensure that the input component is wrapped in BaseFieldLayout after rendering:</p>
		<img src="pictures/BaseFieldHOCwrapper.png" alt="BaseFieldHOC wrapper">
		<p>Full tests listing: <a href="https://github.com/ned-alyona/testing-jest-enzyme/blob/master/shared/hoc/__tests__/BaseFieldHOC.test.js">BaseFieldHOC.test.js</a></p>
	</section>

	<section class="slide test-coverage">
		<h2>Test coverage</h2>
		<figure>
			<img src="pictures/coverage-total.png" alt="Test coverage">
		</figure>
	</section>

	<section class="slide test-coverage">
		<h2>Test coverage</h2>
		<figure>
			<img src="pictures/coverage-part.png" alt="Test coverage">
		</figure>
	</section>

	<section class="slide thank-you">
		<h1>Thank you for your attention!</h1>
	</section>

	<div class="progress"></div>

	<script src="shower/shower.min.js"></script>
</body>
</html>
